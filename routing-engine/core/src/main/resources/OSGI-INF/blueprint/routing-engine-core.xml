<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
	xmlns:camel="http://camel.apache.org/schema/blueprint"
	xsi:schemaLocation="
	   http://camel.apache.org/schema/blueprint
	   http://camel.apache.org/schema/blueprint/camel-blueprint.xsd
	   http://www.osgi.org/xmlns/blueprint/v1.0.0
	   http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0
       http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.1.0.xsd">

	<!-- ================================================================================================= -->
	<!-- Metadata -->
	<!-- ================================================================================================= -->

	<description><![CDATA[VNET::SMS - Core Routing Engine]]></description>

	<reference id="vnet.sms.routing-engine.core.connectionFactory"
		interface="javax.jms.ConnectionFactory" filter="(name=vnet.sms.routing-engine.jms-broker)" />

	<!-- Property place holder -->
	<cm:property-placeholder id="vnet.sms.routing-engine.core.cm"
		persistent-id="vnet.sms.routing_engine.core" placeholder-prefix="${"
		placeholder-suffix="}" update-strategy="reload">
		<cm:default-properties>
			<cm:property name="routing-engine.activemq.queue.incomingMtSms"
				value="Q1" />
			<cm:property name="routing-engine.activemq.queue.outgoingMtSmsAck"
				value="Q2" />
			<cm:property name="routing-engine.activemq.queue.outgoingMtSmsNack"
				value="Q3" />
			<cm:property name="routing-engine.activemq.queue.outgoingMoSms"
				value="Q4" />
		</cm:default-properties>
	</cm:property-placeholder>

	<!-- ================================================================================================= -->
	<!-- Camel JMS component definition -->
	<!-- ================================================================================================= -->

	<bean id="vnet.sms.routing-engine.core.jmsConfig" class="org.apache.camel.component.jms.JmsConfiguration">
		<property name="connectionFactory"
			ref="vnet.sms.routing-engine.core.connectionFactory" />
	</bean>

	<bean id="jms" class="org.apache.camel.component.jms.JmsComponent">
		<argument ref="vnet.sms.routing-engine.core.jmsConfig" />
	</bean>

	<!-- ================================================================================================= -->
	<!-- Processor definition -->
	<!-- ================================================================================================= -->

	<bean id="vnet.sms.routing-engine.core.acknowledgementSmsProcessor"
		class="vnet.sms.routingengine.core.internal.ack.AcknowledgementSmsProcessor">
		<property name="outgoingEndpoints"
			ref="vnet.sms.routing-engine.core.producerTemplate" />
		<property name="outgoingAcksEndpoint"
			ref="vnet.sms.routing-engine.core.outgoingMtSmsAckEp" />
	</bean>

	<!-- ================================================================================================= -->
	<!-- Camel context definition -->
	<!-- ================================================================================================= -->

	<camel:camelContext id="vnet.sms.routing-engine.core.smsRoutingContext"
		useMDCLogging="true">
		<camel:jmxAgent id="vnet.sms.routing-engine.core.camelContextJmxAgent"
			createConnector="false" usePlatformMBeanServer="true" />

		<camel:template id="vnet.sms.routing-engine.core.producerTemplate" />

		<camel:endpoint id="vnet.sms.routing-engine.core.incomingMtSmsEp"
			camelContextId="vnet.sms.routing-engine.core.smsRoutingContext"
			uri="jms:queue:{{routing-engine.activemq.queue.incomingMtSms}}"
			pattern="InOnly" singleton="true" />

		<camel:endpoint id="vnet.sms.routing-engine.core.outgoingMtSmsAckEp"
			camelContextId="vnet.sms.routing-engine.core.smsRoutingContext"
			uri="jms:queue:{{routing-engine.activemq.queue.outgoingMtSmsAck}}"
			pattern="InOnly" singleton="true" />


		<camel:route id="vnet.sms.routing-engine.core.receivedSmsRoutes">
			<camel:from ref="vnet.sms.routing-engine.core.incomingMtSmsEp" />
			<camel:process
				ref="vnet.sms.routing-engine.core.acknowledgementSmsProcessor" />
		</camel:route>
	</camel:camelContext>

</blueprint>
